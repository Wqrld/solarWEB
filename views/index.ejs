<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <div class="row text-center">

            <img style="width:50%" src="/static/zonnepanelen.png" class="img-fluid" alt="Zonnepanelen">
        </div>
    </div>
    <br />
    <div class="container">
        <div class="row">
            <h3>Live stroomopwekking</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Watt DC</th>
                        <th scope="col">Watt AC</th>
                        <th scope="col">Totaal opgewekte energie</th>
                        <th scope="col">Looptijd</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="wattDC">200</td>
                        <td id="wattAC">1</th>
                        <td id="total">6550534 kWh</td>
                        <td id="runtime">5 jaar</td>
                    </tr>
                </tbody>
            </table>
            <script>
                function fetchdata() {
                    fetch("/getdata").then(res => res.json()).then(function (response) {
                        console.log(response);
                        document.getElementById('wattAC').innerHTML = response.wattAC + "W"
                        document.getElementById('wattDC').innerHTML = response.wattDC + "W"
                        document.getElementById('runtime').innerHTML = (response.runtime / 60 / 24 / 365.25).toFixed(1) + " Jaar"
                        document.getElementById('total').innerHTML = response.wattTotaal + " kWh"
                    })
                }
                setInterval(function () {
                    fetchdata()
                }, 10000)

            </script>

        </div>

    </div>
    <div class="container">
        <div class="row">
            <h2>Informatie</h2>
            <p>
                Het Novum heeft sinds een aantal jaar zonnepanelen op het dak staan om zo hun eigen groene energie op te
                wekken. Op deze pagina kan je zien hoe goed dat werkt.<br />
                <br /><br />

                Wat(t) betekenen deze cijfers?<br />
                Watt is een eenheid van energie per seconde. Ter vergelijking:<br />
                Één chromebook gebruikt ongeveer 15 watt. Een desktop computer ongeveer 100 watt.<br />
                Per opgewekte kWh bespaar je ongeveer 0,649 kilogram CO2
                <a
                    href="https://wisenederland.nl/artikel/hoeveel-co2-uitstoot-bespaar-je-als-je-overstapt-op-groene-energie/">(bron)</a>.

                <br />
                Als je dus een uur lang 2000 watt opwekt heb je dus ongeveer 1 kilogram CO2 bespaard.<br />
                Ter vergelijking, de productie van één a4 (toets)blaadje kost ongeveer 6 gram CO2 <a
                    href="https://www.ezeep.com/co2-neutral-printing/">(bron)</a>
                <br /> <br />
                De omvormer verandert de gelijkstroom (DC) van de zonnepanelen naar wisselspanning (AC). De
                stroomopwekking wordt via de omvormer gemeten.
                <br />
                <br />
                Aantal zonnepanelen: 42<br />
                Omvormer capaciteit: 6500W
            </p>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="chart-container" style="position: relative; height:40vh; width:80vw">
                <canvas id="dailyGraph" width="20" height="100"></canvas>
            </div>
            <script src="/static/moment.js"></script>
            <script src="/static/Chart.min.js"></script>

            <script>

                var readouts = <%- readouts %>;

                var mapnew = [];
                var counter;
                for (let i = 0; i < readouts.length; i++) {
                    mapnew.push({ x: moment().add(i * 30, 'seconds'), y: readouts[i].wattDC })
                }

                var ctx = document.getElementById('dailyGraph').getContext('2d');
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        datasets: [{
                            label: 'Watt DC',
                            data: mapnew,
                            backgroundColor: 'rgb(255, 99, 132)',
                            borderColor: 'rgb(255, 99, 132)',
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }],
                            xAxes: [{
                                type: 'time',
                                time: {
                                    displayFormats: {
                                        day: 'DD MMM'
                                    }
                                }
                            }]
                        }
                    }
                });

                fetchdata()

            </script>
        </div>
    </div>

</body>

</html>